# 计算机网络 - 协议

[toc]

## 可靠传输机制

### 停止等待协议

- 相当于发送窗口和接收窗口大小均为1的滑动窗口协议。每发送一个帧，都要等待接收方的确认，然后才能发送下一个帧。

### 后退 N 帧协议

- 相当于发送窗口大于1，接收窗口等于1的滑动窗口协议（尽管滑动窗口协议中发送窗口不能超过接收窗口的大小）。可以连续发送一定数量的帧，直到收到某一个帧的确认（该帧及之前的帧均连带确认），或者发送后超时，然后后退并重发未确认的帧。

### 选择重传协议

- 相当于发送窗口和接收窗口均大于1的滑动窗口协议。相比后退 N 帧协议，只是选择性的重传已经确认超时的帧或者已经被否定的帧（收到了否定帧）。
- 选择重传协议和后退N帧协议均涉及对帧的识别问题，因此需要通过序号来区分帧。

## 滑动窗口协议

滑动窗口协议主要是用来控制发送方的发送速率的。

### 数据链路层

- **目标**：控制链路上帧的发送速率，以使接收方有足够的缓冲空间来接收每个帧。
- 数据链路层的窗口大小是固定的，如果接收窗口为 1（如停止等待协议和后退 N 帧协议），可以实现数据的有序接收（因为发送方一定是有序发送的，而不会选择重传）。
- 假设使用 n 比特对帧编号，为保证移动接收方的窗口向前移动后，新窗口的序号和就窗口的序号没有重叠的地方，需要保证**发送窗口+接收窗口 $<2^n$** 。举例，编号字段为 3 比特，可以编号 8 个，假设发送窗口为 4，接收窗口为 5，则发送窗口发送 0,1,2,3 ，接收窗口准备接收 0,1,2,3,4 ，如果全部接收，则滑动 4 个长度，准备接收 4,5,6,7,0 ，并发回确认。如果确认帧丢失，发送方会重传 0,1,2,3 ，即 0 号属于重传帧，如果确认帧没有丢失，则 0 号帧属于允许的顺序接收范围，因此 0 号帧就出现了歧义。
- **注**：教材上数据链路层已不提供数据链路层关于可靠传输的内容（帧编号、确认、重传）[^1]。

### 传输层

- **目标**：同数据链路层。
- 传输层的窗口大小是动态变化的。发送窗口同时受接收窗口和拥塞窗口限制，拥塞窗口受拥塞控制算法调整。

## 访问控制

### CSMA协议

- CSMA, Carrier Sense Multiple Access, 载波侦听多路访问。
- 三种CSMA协议
  - 1-坚持：忙则侦听，闲则立即使用，冲突则随机等待一段时间并侦听。
  - 非检查：忙则随机等待，闲则立即使用
  - p-坚持：忙则侦听，闲则p概率发送，1-p概率推迟到下一个时隙（时分信道）。

### CSMA/CD协议

- CSMA/CD，Carrier Sense Multiple Access with Collision Detection, 载波侦听多路访问，碰撞检测。
- 碰撞检测是指边发送边侦听。先听后发，边听边发。
- 设 $\tau$ 为单向传播时延，则可以分析出争用期为 $2\tau$ （又称冲突窗口或碰撞窗口）。
- 确定了网络的最小帧长，则该帧长对应的发送时间就是争用期。也即如果发送一个帧结束还没有出现碰撞，那么就不会碰撞。

## 网际协议 IP

- 网际协议 IP 是 TCP/IP 协议簇中最主要的协议之一（另一个当然是传输层的 TCP 协议）。
- 特殊 IP 地址
  - 主机号全为 0 表示本网络。如 192.168.1.0 。
  - 主机号全为 1 表示本网络广播地址，又称直接广播地址，如 192.168.1.255 。
  - 127.0.0.0 保留为环路自检（Loopback Test）地址，表示主机本身。
  - 0.0.0.0 表示本网络上的本主机。
  - 255.255.255.255 表示全部网络的广播地址，又称受限广播地址。实际等效于本网络的广播地址。

- 子网
  - 通过子网号字段，将 IP 地址的二级结构（网络号+主机号）变成三级结构，称为**子网划分**。
  - 子网划分对主机号进行划分，不改变网络号。
  - **子网掩码**由一串 1 和跟随的一串 0 组成。没有划分子网的，使用默认的子网掩码（如 C 类地址为 255.255.255.0）。网络地址和子网掩码同时确定一个网络，路由表的一行中包含目的网络地址、子网掩码、下一跳地址。对于一个 IP 数据报，将其目的 IP 地址与每一行的子网掩码相与得到网络地址，匹配则转发。

- 无分类域间路由选择（CIDR）
  - 将传统的网络号和子网号合并为**网络前缀**。IP 地址结构为网络前缀+主机号。
  - 网络前缀相同的 IP 地址组成 CIDR 地址块，一个 CIDR 地址块代表很多个 IP 地址，称为**路由聚合**，或称构成 **超网**。
  - CIDR 地址块内部仍然可以进行子网划分。
  - 路由匹配过程中，如果由多个匹配项，则选择具有最长网络前缀的路由项，称为**最长前缀匹配**。

## ARP,RARP,ICMP,IGMP

- 这四个协议都属于 TCP/IP 协议簇 IP 层的配套协议。
- ARP
  - Address Resolution Protocol
  - 地址解析协议
- RARP
  - Reverse Resolution Protocol
  - 逆地址解析协议
- ICMP
  - Internet Control Message Protocol
  - 网际报文控制协议
- IGMP
  - Internet Group Menagement Protocol
  - 网际组管理协议
- 四个协议中，ICMP 和 IGMP 在网际协议 IP 之上层，ARP 和 RARP 在网际协议 IP 之下层（同一层中的相对关系）。

## TCP/UDP

- TCP 和 UDP 属于 TCP/IP 协议簇在传输层的两个协议。TCP 协议是 TCP/IP 协议簇中最主要的协议之一。

## 应用层常见协议

- DNS
  - Domain Name System
  - 域名系统
  - 传输层使用 UDP 协议。
  - 端口 53 。
  - 内容：`WWW 万维网，<协议>://<主机地址>:<端口>/<路径>`。主机地址可以是域名，如果是域名，则需要进行 DNS 解析。对 `www.abc.com` ，共三级域名，DNS 解析过程为：  
  1. 以域名请求本地域名服务器  
  2. 本地域名服务器收到请求后，进行迭代查询，先请求根域名服务器（如 `a.rootservers.net`），根域名服务器返回顶级域名服务器 `dns.com` 的地址  
  3. 本地域名服务器向顶级域名服务器dns.com查询，顶级域名服务器返回权限域名服务器 `dns.abc.com` 的地址  
  4. 本地服务器向 `dns.abc.com` 查询，`dns.abc.com` 返回 `www.abc.com` 的地址。  
  5. 本地服务器返回域名 `www.abc.com` 的地址  
  注意：高级别 DNS 服务器只是返回要查询的域名所在的下一级服务器地址，直到域名在域名服务器所在层次。  
  根服务器( `*` )-->顶级服务器( `*.com` )-->权限服务器( `*.abc.com` )-->...  
  从**记忆的角度**而言，对一个 3 级域名，迭代查询可以理解为每次查询一个域名层次。第一次查询 `com` ，第二次查询 `abc.com` ，第三次查询 `dns.abc.com` ，即查询结束。  
- FTP
  - File Transfer Protocol
  - 文件传送协议
  - FTP 基于 TCP ，TFTP 基于 UDP 。
  - FTP 端口为 21 。
- WWW
  - World Wide Web
  - 万维网
  - 万维网是一个大规模的、联机式的信息储藏所。
- HTTP
  - HyperText Transfer Protocol
  - 超文本传送协议
  - 基于 TCP ，端口为 80 。
- URL
  - Uniform Resource Locator
  - 统一资源定位符
  - 格式：`<protocol>://<host>:<port>/<path>`
- SMTP
  - Simple Mail Transfer Protocol
  - 简单邮件传送协议
  - 属于**邮件发送协议**。
  - 只能传送 7 位 ASCII 码。
  - 不使用中间的邮件服务器。
- MIME
  - Multipurpose Internet Mail Extensions
  - 通用因特网邮件扩充
  - 说明数据类型（文本、声音、图像、视频）。
- POP3
  - Post Office Protocol V3
  - 邮局协议版本 3
  - 属于**邮件读取协议**。
- IMAP
  - Internet Message Access Protocol
  - 网际报文存取协议
  - 属于**邮件读取协议**。
  - 比 POP3 更加复杂。
- 邮件：发件人的用户代理向**发送方邮件服务器**发送邮件，以及**发送方邮件服务器**向**收件方邮件服务器**发送邮件，都是使用邮件发送协议（SMTP）。**用户代理**从**接收方邮件服务器**上读取邮件使用邮件读取协议（IMAP、POP3等）。
- DHCP
  - Dynamic Host Configuration
  - 动态主机配置协议
  - 基于 UDP 协议。
  - 配置项目： IP 地址；子网掩码；默认路由的 IP 地址；域名服务器 IP 地址。
  - DHCP 中继代理：
- SNMP
  - Simple Network Management Protocol
  - 简单网络管理协议

[^1]: 《计算机网络·第 5 版》，谢希仁。3.1.2 三个基本问题。
